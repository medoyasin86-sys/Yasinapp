<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y.Karizma Battle Log</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --ff-gold: #ffbe0b;
            --ff-dark: #09090b;
            --ff-panel: #18181b;
            --heroic-red: #ff003c;
            --booyah-yellow: #f1c40f;
            --rare-blue: #00d2d3;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: #000;
            margin: 0;
            display: flex;
            justify-content: center;
            color: #fff;
            overflow-x: hidden;
            user-select: none;
        }

        .battle-container {
            width: 100%;
            max-width: 450px;
            background: var(--ff-dark);
            min-height: 100vh;
            border: 1px solid #333;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø±: Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ù…Ø¯Ø¬Ø¬ --- */
        .warrior-header {
            width: 100%;
            height: 350px;
            position: relative;
            /* ØµÙˆØ±Ø© Ù…Ø­Ø§Ø±Ø¨ ÙØ±ÙŠ ÙØ§ÙŠØ± ÙŠØ­Ù…Ù„ Ø³Ù„Ø§Ø­Ø§Ù‹ */
            background: url('https://w0.peakpx.com/wallpaper/122/357/HD-wallpaper-free-fire-cobra-skin-android-game-mobile-thumbnail.jpg') center top/cover no-repeat;
            display: flex;
            align-items: flex-end;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 50% 100%, 0 90%);
            margin-bottom: -40px;
            z-index: 10;
        }

        .warrior-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, var(--ff-dark), transparent 80%);
        }

        .profile-info {
            position: relative;
            z-index: 2;
            padding: 20px;
            width: 100%;
            text-shadow: 2px 2px 4px #000;
            padding-bottom: 50px;
        }

        .rank-badge {
            background: linear-gradient(45deg, #d35400, #e67e22);
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 1px;
            border: 1px solid #fff;
            box-shadow: 0 0 10px #e67e22;
        }

        .player-name {
            font-size: 36px;
            font-weight: 900;
            margin: 5px 0 0 0;
            color: #fff;
            font-style: italic;
            letter-spacing: -1px;
        }
        .player-name span { color: var(--ff-gold); }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‡Ø§Ù… --- */
        .mission-control {
            padding: 60px 15px 20px 15px; /* Padding top Ù„ØªØ¹ÙˆÙŠØ¶ Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
            background: var(--ff-dark);
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ØµÙŠØ¯ */
        .stats-card {
            background: linear-gradient(135deg, #2c3e50, #000);
            border: 1px solid #444;
            border-left: 5px solid var(--ff-gold);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .money-display small { color: #aaa; font-size: 11px; display: block;}
        .money-display strong { font-size: 32px; color: var(--ff-gold); line-height: 1; }
        
        .streak-badge {
            text-align: center;
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 6px;
        }
        .streak-num { font-size: 24px; font-weight: bold; color: var(--heroic-red); display: block; }
        .streak-lbl { font-size: 9px; color: #fff; opacity: 0.7; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .action-grid {
            display: grid;
            gap: 10px;
            margin-bottom: 25px;
        }

        .date-picker {
            background: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 12px;
            text-align: center;
            font-family: 'Cairo';
            font-weight: bold;
            width: 100%;
            box-sizing: border-box;
            border-radius: 4px;
        }

        .btn-main {
            border: none;
            padding: 15px;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: transform 0.1s;
            position: relative;
            overflow: hidden;
        }
        .btn-main:active { transform: scale(0.96); }

        .btn-win { 
            background: linear-gradient(90deg, #f1c40f, #f39c12); 
            color: #000; 
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.4);
        }
        
        .btn-loss { 
            background: linear-gradient(90deg, #c0392b, #e74c3c); 
            color: #fff; 
            opacity: 0.8;
        }

        /* --- Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ø±Ùƒ (Ø§Ù„Ø¬Ø¯ÙŠØ¯) --- */
        .battle-log-container {
            background: var(--ff-panel);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #333;
            margin-bottom: 20px;
        }

        .log-title {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
        .history-list::-webkit-scrollbar { width: 4px; }
        .history-list::-webkit-scrollbar-thumb { background: var(--ff-gold); border-radius: 2px; }

        .log-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.3);
            margin-bottom: 6px;
            padding: 10px;
            border-radius: 4px;
            border-right: 3px solid transparent;
            animation: fadeIn 0.3s ease;
        }

        .log-item.dry { border-right-color: var(--ff-gold); background: linear-gradient(90deg, rgba(0,0,0,0.3), rgba(241, 196, 15, 0.1)); }
        .log-item.wet { border-right-color: var(--heroic-red); opacity: 0.7; }

        .log-date { font-size: 13px; font-weight: bold; color: #ddd; }
        .log-status { font-size: 11px; font-weight: 900; padding: 2px 8px; border-radius: 2px; }
        .status-booyah { color: var(--booyah-yellow); text-shadow: 0 0 5px var(--booyah-yellow); }
        .status-defeat { color: #e74c3c; }

        @keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… */
        .sys-msg {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 999;
            font-weight: bold;
            display: none;
            box-shadow: 0 5px 15px #000;
        }

        /* Ø§Ù„Ø´Ø§Øª */
        .squad-chat {
            background: #111;
            padding: 15px;
            border-top: 1px solid #333;
        }
        .chat-box { height: 100px; overflow-y: auto; font-size: 12px; margin-bottom: 10px; }
        .msg { padding: 5px; margin-bottom: 5px; border-radius: 3px; background: rgba(255,255,255,0.05); }
        .input-group { display: flex; gap: 5px; }
        .chat-input { flex: 1; background: #222; border: none; color: white; padding: 10px; border-radius: 4px; }
        .btn-send { background: var(--ff-gold); border: none; padding: 0 15px; font-weight: bold; border-radius: 4px; }
    </style>
</head>
<body>

<div class="sys-msg" id="alert-box">âš ï¸ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø³Ø¬Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®!</div>

<div class="battle-container">
    <div class="warrior-header">
        <div class="profile-info">
            <div class="rank-badge">HEROIC ğŸ’</div>
            <h1 class="player-name">Y.<span>KARIZMA</span></h1>
            <div style="font-size: 12px; color: #ccc;">Ø§Ù„Ù‚Ø§Ø¦Ø¯ ÙŠØ§Ø³ÙŠÙ† - Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2</div>
        </div>
    </div>

    <div class="mission-control">
        
        <div class="stats-card">
            <div class="money-display">
                <small>CURRENT BOUNTY (Ø§Ù„Ø±ØµÙŠØ¯)</small>
                <strong><span id="money">1000</span> <span style="font-size:14px">EGP</span></strong>
            </div>
            <div class="streak-badge">
                <span class="streak-num" id="streak-val">0</span>
                <span class="streak-lbl">KILLSTREAK ğŸ”¥</span>
            </div>
        </div>

        <div class="action-grid">
            <input type="date" id="mission-date" class="date-picker">
            <button class="btn-main btn-win" onclick="attemptSave(true)">
                BOOYAH! ğŸ† (Ø¬Ø§Ù)
            </button>
            <button class="btn-main btn-loss" onclick="attemptSave(false)">
                ELIMINATED ğŸ’€ (Ù…Ø¨Ù„Ù„)
            </button>
        </div>

        <div class="battle-log-container">
            <div class="log-title">
                <span>BATTLE HISTORY</span>
                <span>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ø±Ùƒ</span>
            </div>
            <div class="history-list" id="history-log">
                <div style="text-align: center; color: #555; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
            </div>
        </div>

        <div class="squad-chat">
            <div style="color: var(--ff-gold); font-size: 10px; margin-bottom: 5px; font-weight: bold;">SQUAD RADIO:</div>
            <div class="chat-box" id="chat"></div>
            <div class="input-group">
                <input type="text" id="msg-input" class="chat-input" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„ÙƒØªÙŠØ¨Ø©...">
                <button class="btn-send" onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>

    </div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³
    const firebaseConfig = {
        apiKey: "AIzaSyAPhrEzYnHoL3ln8_5BFFyWCjx2Y-G80E0",
        authDomain: "yassinapp-20262.firebaseapp.com",
        databaseURL: "https://yassinapp-20262-default-rtdb.firebaseio.com",
        projectId: "yassinapp-20262",
        storageBucket: "yassinapp-20262.firebasestorage.app",
        messagingSenderId: "940031861888",
        appId: "1:940031861888:web:9b7600cbf80b6343"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let historyData = {};
    const todayStr = new Date().toISOString().split('T')[0];
    document.getElementById('mission-date').value = todayStr;

    // --- 1. Ø¬Ù„Ø¨ ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
    db.ref('yassin_money_quest/history').on('value', (snapshot) => {
        historyData = snapshot.val() || {};
        updateUI(historyData);
    });

    db.ref('yassin_chat').limitToLast(10).on('value', (snapshot) => {
        const chatDiv = document.getElementById('chat');
        chatDiv.innerHTML = '';
        snapshot.forEach(child => {
            const m = child.val();
            chatDiv.innerHTML += `<div class="msg"><b style="color:${m.sender==='Y.KARIZMA'?'var(--ff-gold)':'#fff'}">${m.sender}:</b> ${m.text}</div>`;
        });
        chatDiv.scrollTop = chatDiv.scrollHeight;
    });

    // --- 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ ---
    function updateUI(history) {
        const entries = Object.entries(history).sort((a, b) => b[0].localeCompare(a[0])); // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
        
        // Ø£) Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ø³ØªØ±ÙŠÙƒ
        let streak = 0;
        let wetCount = 0;
        let isStreakBroken = false;

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ØªØ±ÙŠÙƒ Ù…Ù† Ø£Ø­Ø¯Ø« ÙŠÙˆÙ… Ù…Ø³Ø¬Ù„
        for (let i = 0; i < entries.length; i++) {
            if (entries[i][1] === 'dry' && !isStreakBroken) {
                streak++;
            } else {
                isStreakBroken = true; // ØªÙˆÙ‚Ù Ø§Ù„Ø³ØªØ±ÙŠÙƒ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø®Ø·Ø£ Ø£Ùˆ ÙØ¬ÙˆØ©
            }
            if (entries[i][1] === 'wet') wetCount++;
        }

        // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„ (30 ÙŠÙˆÙ…)ØŒ ÙƒÙ„ Ø®Ø·Ø£ ÙŠØ®ØµÙ… 50
        let money = 1000;
        if (entries.length > 30) {
            money = Math.max(0, 1000 - (wetCount * 50));
        }

        document.getElementById('money').innerText = money;
        document.getElementById('streak-val').innerText = streak;

        // Ø¨) ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ø±Ùƒ (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
        const logContainer = document.getElementById('history-log');
        logContainer.innerHTML = '';

        if (entries.length === 0) {
            logContainer.innerHTML = '<div style="text-align:center; padding:10px; color:#555">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ù…Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</div>';
        }

        entries.forEach(([date, status]) => {
            const isWin = status === 'dry';
            const html = `
                <div class="log-item ${status}">
                    <span class="log-date">${date}</span>
                    <span class="log-status ${isWin ? 'status-booyah' : 'status-defeat'}">
                        ${isWin ? 'BOOYAH! ğŸ–ï¸' : 'DEFEAT âŒ'}
                    </span>
                </div>
            `;
            logContainer.innerHTML += html;
        });
    }

    // --- 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± ---
    function attemptSave(isDry) {
        const selectedDate = document.getElementById('mission-date').value;

        // Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ
        if (historyData.hasOwnProperty(selectedDate)) {
            showAlert("âš ï¸ Ù‚Ø§Ø¦Ø¯ Ø§Ù„ÙƒØªÙŠØ¨Ø©: ØªÙ… Ø±ØµØ¯ Ù†ØªÙŠØ¬Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù…Ø³Ø¨Ù‚Ø§Ù‹! Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙƒØ±Ø§Ø±.");
            return; // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ†ÙÙŠØ°
        }

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¬Ø¯ÙŠØ¯Ø§Ù‹ØŒ Ø§Ø­ÙØ¸
        if(isDry) {
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#ffbe0b', '#00d2d3'] });
        }
        
        db.ref('yassin_money_quest/history').update({ [selectedDate]: isDry ? 'dry' : 'wet' })
          .then(() => {
              showAlert(isDry ? "ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†ØµØ±! ğŸ›¡ï¸" : "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø³Ø§Ø±Ø©.. Ø¹ÙˆØ¶Ù‡Ø§ ØºØ¯Ø§Ù‹!", isDry ? "#2ecc71" : "#e74c3c");
          });
    }

    // --- 4. Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---
    function sendMessage() {
        const inp = document.getElementById('msg-input');
        if(!inp.value) return;
        db.ref('yassin_chat').push({ text: inp.value, sender: 'BABA', date: todayStr });
        inp.value = '';
    }

    function showAlert(msg, color = "#ff003c") {
        const alertBox = document.getElementById('alert-box');
        alertBox.innerText = msg;
        alertBox.style.background = color;
        alertBox.style.display = 'block';
        setTimeout(() => { alertBox.style.display = 'none'; }, 3000);
    }
</script>

</body>
</html>
