<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y.Karizma - Ultimate Warrior</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --ff-gold: #ffbe0b;
            --ff-dark: #05070a;
            --ff-card: #11141b;
            --heroic-red: #ff003c;
            --success-green: #00ff88;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: #000;
            margin: 0;
            display: flex;
            justify-content: center;
            color: #fff;
            overflow-x: hidden;
        }

        .battle-container {
            width: 100%;
            max-width: 450px;
            background: var(--ff-dark);
            min-height: 100vh;
            border-left: 1px solid #222;
            border-right: 1px solid #222;
            position: relative;
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ù…Ø¯Ø¬Ø¬ */
        .warrior-header {
            width: 100%;
            height: 380px;
            position: relative;
            background: url('https://w0.peakpx.com/wallpaper/406/339/wallpaper-free-fire-warrior-with-gun-thumbnail.jpg') center top/cover no-repeat;
            display: flex;
            align-items: flex-end;
            border-bottom: 4px solid var(--ff-gold);
        }

        .warrior-header::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, var(--ff-dark) 10%, transparent 90%);
        }

        .player-info {
            position: relative;
            z-index: 5;
            padding: 20px;
            width: 100%;
        }

        .rank-tag {
            background: var(--heroic-red);
            padding: 2px 10px;
            font-size: 11px;
            font-weight: 900;
            border-radius: 3px;
            box-shadow: 0 0 15px var(--heroic-red);
        }

        .player-name {
            font-size: 40px;
            font-weight: 900;
            color: #fff;
            margin: 5px 0;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        /* Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù‚Ø§Ø¦Ø¯ */
        .commander-orders {
            background: rgba(255, 190, 11, 0.1);
            border: 1px dashed var(--ff-gold);
            margin: 15px;
            padding: 12px;
            font-size: 12px;
            border-radius: 8px;
            color: #eee;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² */
        .loot-card {
            background: var(--ff-card);
            margin: 0 15px 15px 15px;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #333;
            box-shadow: inset 0 0 20px #000;
        }

        .bounty-amount {
            font-size: 50px;
            font-weight: 900;
            color: var(--ff-gold);
            display: block;
            line-height: 1;
        }

        /* Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ® */
        .date-shifter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1c212a;
            margin: 0 15px 15px 15px;
            padding: 8px;
            border-radius: 8px;
        }

        .shift-btn {
            background: #333;
            border: none;
            color: var(--ff-gold);
            width: 40px;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
        }

        .date-display {
            flex: 1;
            text-align: center;
            font-weight: 900;
            cursor: pointer;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¹Ø±ÙƒØ© */
        .battle-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 0 15px 25px 15px;
        }

        .action-btn {
            padding: 20px 10px;
            border: none;
            font-family: 'Cairo';
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .btn-booyah { background: var(--ff-gold); color: #000; }
        .btn-defeat { background: #333; color: #777; }
        .btn-locked { opacity: 0.3; cursor: not-allowed; }

        /* Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ø±Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ */
        .battle-log {
            background: #090b10;
            margin: 0 15px;
            border-radius: 10px;
            border: 1px solid #222;
        }

        .log-header {
            padding: 10px;
            font-size: 12px;
            color: var(--ff-gold);
            border-bottom: 1px solid #222;
            display: flex;
            justify-content: space-between;
        }

        .log-list {
            max-height: 250px;
            overflow-y: auto;
            padding: 5px;
        }

        .log-entry {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.03);
            border-radius: 4px;
            font-size: 13px;
        }

        .status-win { color: var(--success-green); font-weight: bold; }
        .status-loss { color: var(--heroic-red); font-weight: bold; }

        input[type="date"] {
            display: none;
        }
    </style>
</head>
<body>

<div class="battle-container">
    <div class="warrior-header">
        <div class="player-info">
            <span class="rank-tag">GRANDMASTER ğŸ–ï¸</span>
            <h1 class="player-name">Y.KARIZMA</h1>
            <div style="font-size: 12px; color: #aaa;">MISSION: DRY PROTOCOL v4.0</div>
        </div>
    </div>

    <div class="commander-orders">
        ğŸ’¬ <b>Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù‚Ø§Ø¦Ø¯:</b> Ø´Ù‡Ø± ÙŠÙ†Ø§ÙŠØ± Ù‡Ùˆ "ØªØ¯Ø±ÙŠØ¨" ÙˆØ§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø«Ø§Ø¨ØªØ© (1000Ø¬). <br>
        <span style="color: var(--heroic-red)">Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…:</span> Ø®Ø·Ø£ ÙˆØ§Ø­Ø¯ Ø³ÙŠÙƒÙ„ÙÙƒ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ØŒ ÙˆØ³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¬Ø§Ù Ø¨Ù€ 10Ø¬ ÙÙ‚Ø·!
    </div>

    <div class="loot-card">
        <span style="font-size: 12px; color: #888;">STRATEGIC BOUNTY (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ)</span>
        <span class="bounty-amount" id="money">1000</span>
        <span style="font-size: 14px; font-weight: bold;">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</span>
    </div>

    <div class="date-shifter">
        <button class="shift-btn" onclick="changeDay(-1)">â—€</button>
        <div class="date-display" onclick="document.getElementById('date-input').showPicker()">
            <div id="date-text">ØªØ­Ù…ÙŠÙ„...</div>
            <div id="status-text" style="font-size:10px; color: #555;">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±ØµØ¯</div>
        </div>
        <button class="shift-btn" onclick="changeDay(1)">â–¶</button>
        <input type="date" id="date-input" onchange="setDate(this.value)">
    </div>

    <div class="battle-actions" id="action-area">
        <button class="action-btn btn-booyah" id="win-btn" onclick="register(true)">BOOYAH! âš¡</button>
        <button class="action-btn btn-defeat" id="loss-btn" onclick="register(false)">DEFEAT ğŸ’€</button>
    </div>

    <div class="battle-log">
        <div class="log-header">
            <span>Ø³Ø¬Ù„ Ù…Ø¹Ø§Ø±Ùƒ Ø§Ù„Ø´Ù‡Ø±</span>
            <span id="month-stat">0/0</span>
        </div>
        <div class="log-list" id="history-log">
            </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAPhrEzYnHoL3ln8_5BFFyWCjx2Y-G80E0",
        authDomain: "yassinapp-20262.firebaseapp.com",
        databaseURL: "https://yassinapp-20262-default-rtdb.firebaseio.com",
        projectId: "yassinapp-20262",
        storageBucket: "yassinapp-20262.firebasestorage.app",
        messagingSenderId: "940031861888",
        appId: "1:940031861888:web:9b7600cbf80b6343"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let historyData = {};
    let activeDate = new Date(); // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø¸Ø± Ø¥Ù„ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠØ§Ù‹

    // --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---

    function updateDisplay() {
        const key = activeDate.toISOString().split('T')[0];
        const dateOptions = { weekday: 'long', day: 'numeric', month: 'long' };
        document.getElementById('date-text').innerText = activeDate.toLocaleDateString('ar-EG', dateOptions);
        
        const winBtn = document.getElementById('win-btn');
        const lossBtn = document.getElementById('loss-btn');
        const statusText = document.getElementById('status-text');

        if (historyData[key]) {
            winBtn.classList.add('btn-locked');
            lossBtn.classList.add('btn-locked');
            winBtn.disabled = true;
            lossBtn.disabled = true;
            const isWin = historyData[key] === 'dry';
            statusText.innerText = isWin ? "âœ… ØªÙ… Ø§Ù„Ø±ØµØ¯: Ø§Ù†ØªØµØ§Ø±" : "âŒ ØªÙ… Ø§Ù„Ø±ØµØ¯: Ù‡Ø²ÙŠÙ…Ø©";
            statusText.style.color = isWin ? "var(--success-green)" : "var(--heroic-red)";
        } else {
            winBtn.classList.remove('btn-locked');
            lossBtn.classList.remove('btn-locked');
            winBtn.disabled = false;
            lossBtn.disabled = false;
            statusText.innerText = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø±ØµØ¯ Ø§Ù„Ù…Ù‡Ù…Ø©...";
            statusText.style.color = "#555";
        }
    }

    function changeDay(delta) {
        activeDate.setDate(activeDate.getDate() + delta);
        updateDisplay();
    }

    function setDate(val) {
        activeDate = new Date(val);
        updateDisplay();
    }

    // --- Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ---

    db.ref('yassin_money_quest/history').on('value', (snapshot) => {
        historyData = snapshot.val() || {};
        calculateBounty(historyData);
        renderLog(historyData);
        updateDisplay();
    });

    function calculateBounty(history) {
        const today = new Date();
        const currentYear = today.getFullYear();
        const currentMonth = today.getMonth(); // 0 = ÙŠÙ†Ø§ÙŠØ±

        let dryCount = 0;
        let wetCount = 0;
        let hasWetInCurrentMonth = false;

        Object.entries(history).forEach(([dateStr, status]) => {
            const d = new Date(dateStr);
            // Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            if (d.getMonth() === activeDate.getMonth() && d.getFullYear() === activeDate.getFullYear()) {
                if (status === 'dry') dryCount++;
                else {
                    wetCount++;
                    hasWetInCurrentMonth = true;
                }
            }
        });

        let finalMoney = 1000;
        
        // Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØµØ§Ø±Ù…Ø©: Ù„Ùˆ Ù…Ø´ Ø´Ù‡Ø± ÙŠÙ†Ø§ÙŠØ± 2026 (Ø´Ù‡Ø± Ø§Ù„ØªØ¯Ø±ÙŠØ¨)
        // Ø´Ù‡Ø± ÙŠÙ†Ø§ÙŠØ± 2026 Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ù‡Ùˆ Ø³Ù†Ø© 2026 ÙˆØ´Ù‡Ø± 0
        const isTrainingMonth = (activeDate.getFullYear() === 2026 && activeDate.getMonth() === 0);

        if (!isTrainingMonth) {
            if (hasWetInCurrentMonth) {
                finalMoney = dryCount * 10; // 10 Ø¬Ù†ÙŠÙ‡ Ù„ÙƒÙ„ ÙŠÙˆÙ… Ø¬Ø§Ù
            } else {
                finalMoney = 1000; // Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ù„Ùˆ Ø§Ù„Ø´Ù‡Ø± ÙƒØ§Ù…Ù„ Ù†Ø¸ÙŠÙ
            }
        } else {
            finalMoney = 1000; // Ø´Ù‡Ø± ÙŠÙ†Ø§ÙŠØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹ 1000
        }

        document.getElementById('money').innerText = finalMoney;
        document.getElementById('month-stat').innerText = `Dry: ${dryCount} | Wet: ${wetCount}`;
    }

    function renderLog(history) {
        const logList = document.getElementById('history-log');
        logList.innerHTML = '';
        
        // ØªØ±ØªÙŠØ¨ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹
        const sorted = Object.entries(history).sort((a, b) => b[0].localeCompare(a[0]));
        
        sorted.forEach(([date, status]) => {
            const d = new Date(date);
            // Ø¥Ø¸Ù‡Ø§Ø± Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
            if (d.getMonth() === activeDate.getMonth() && d.getFullYear() === activeDate.getFullYear()) {
                const isWin = status === 'dry';
                logList.innerHTML += `
                    <div class="log-entry">
                        <span>${date}</span>
                        <span class="${isWin ? 'status-win' : 'status-loss'}">${isWin ? 'BOOYAH' : 'DEFEAT'}</span>
                    </div>
                `;
            }
        });
    }

    function register(isDry) {
        const key = activeDate.toISOString().split('T')[0];
        
        if (historyData[key]) return; // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±

        if (isDry) {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }

        db.ref('yassin_money_quest/history').update({ [key]: isDry ? 'dry' : 'wet' });
    }

    // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„ØªÙ‚ÙˆÙŠÙ…
    document.getElementById('date-input').valueAsDate = new Date();
    updateDisplay();
</script>

</body>
</html>
